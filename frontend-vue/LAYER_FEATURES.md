# 图层功能说明

本项目已参考 `openlayers-demo` 项目，实现了完整的图层管理功能。

## 已实现功能

### 1. 多图层管理 ✅
- **工位图层**：显示车间工位位置和状态（运行/空闲）
- **物料图层**：显示物料位置和状态（到达/处理中/完成）
- **缓冲区图层**：显示缓冲区位置和容量信息
- **路径图层**：显示车间内的路径连接
- **区域图层**：显示输入/输出区域
- **边界图层**：显示车间边界
- **底图图层**：支持图片底图和矢量底图

### 2. 图层显示控制 ✅
- 通过复选框控制各图层的显示/隐藏
- 实时响应图层可见性变化
- 支持独立控制每个图层

### 3. 主题视图切换 ✅
- **全部视图**：显示所有图层
- **生产视图**：仅显示工位、物料、路径图层
- **缓冲区视图**：仅显示缓冲区、物料、路径图层

### 4. 地图缩放分层 ✅
- **车间全景视图**（zoom ≤ 1.8）：显示完整车间概览
- **区域概览**（zoom 1.8-3.5）：显示区域边界和概览信息
- **详细视图**（zoom > 3.5）：根据当前中心点显示对应区域的详细信息

### 5. 底图设置 ✅
- 支持图片底图（ImageStatic）
- 支持矢量底图（GeoJSON）
- 可切换底图显示/隐藏
- 根据缩放级别自动调整底图透明度

## 文件结构

```
frontend-vue/
├── src/
│   ├── config/
│   │   └── mapLayers.js          # 图层配置和层级定义
│   ├── components/
│   │   ├── LayerControl.vue      # 图层控制组件
│   │   └── MapView.vue           # 地图视图组件（已增强）
│   ├── composables/
│   │   └── useOpenLayers.js      # OpenLayers 地图逻辑（已增强）
│   └── App.vue                   # 主应用组件（已集成图层控制）
```

## 使用方法

### 图层控制
1. 在右侧边栏的"图层控制"面板中
2. 勾选/取消勾选复选框来控制图层显示
3. 选择不同的视图模式快速切换图层组合

### 缩放分层
1. 使用鼠标滚轮或缩放控件缩放地图
2. 地图会根据缩放级别自动切换显示层级
3. 右上角会显示当前层级信息

### 底图设置
1. 在图层控制面板中选择底图类型
2. 可选择：无底图、图片底图、矢量底图

## 配置说明

### 缩放阈值配置
在 `src/config/mapLayers.js` 中可以调整缩放阈值：

```javascript
zoomThresholds: {
  showRegions: 1.8,    // 显示区域边界的缩放级别
  showDetails: 3.5,    // 显示详细图层的缩放级别
  hideOverview: 2.5    // 降低总览图层透明度的缩放级别
}
```

### 区域定义
在 `src/config/mapLayers.js` 中可以定义区域：

```javascript
regions: [
  {
    id: 'input_zone',
    name: '输入区域',
    bounds: [0, 0, 20, 40],  // [minX, minY, maxX, maxY]
    center: [10, 20]
  },
  // ...
]
```

## 技术实现

### 图层管理
- 使用 OpenLayers 的 `VectorLayer` 和 `ImageLayer`
- 每个图层独立管理，支持单独控制可见性
- 通过 `zIndex` 控制图层渲染顺序

### 缩放分层
- 监听地图视图的 `change:resolution` 事件
- 根据当前缩放级别和中心点判断应该显示的图层
- 平滑过渡图层透明度变化

### 响应式更新
- 使用 Vue 3 的响应式系统
- 图层可见性变化实时反映到地图上
- 层级信息定期更新显示

## 注意事项

1. **底图图片**：如果使用图片底图，需要将图片放在 `public/map_image.png`
2. **GeoJSON 数据**：矢量底图数据通过后端 API 获取
3. **性能优化**：大量要素时建议使用图层可见性控制来优化性能
4. **缩放范围**：当前缩放范围设置为 0.5-5，可根据需要调整

## 后续扩展

可以进一步扩展的功能：
- 图层样式自定义
- 更多主题视图
- 图层透明度控制
- 图层顺序调整
- 图层数据筛选

