# 🏭 SimPy-OpenLayers 生产线仿真可视化系统

一个融合 **SimPy** 离散事件仿真和 **OpenLayers** 地理可视化的智能制造演示系统。

## 📋 项目简介

本项目展示了如何将生产系统仿真分析与地图可视化技术相结合，实现：

- ✅ **SimPy** - 强大的生产线离散事件仿真引擎
- ✅ **OpenLayers** - 专业的地理空间数据可视化
- ✅ **实时通信** - WebSocket 实时推送仿真数据
- ✅ **动态展示** - 车间布局、设备状态、物料流转的实时可视化

### 🎯 系统特性

1. **生产线仿真**
   - 3工位串行生产线模拟
   - 缓冲区管理
   - 资源竞争与排队
   - 随机加工时间

2. **实时可视化**
   - OpenLayers 地图展示车间布局
   - 物料流转路径动画
   - 设备状态实时更新
   - 缓冲区库存显示

3. **统计分析**
   - 产量统计
   - 工位利用率
   - 周期时间分析
   - 在制品监控

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────┐
│                   前端 (Browser)                     │
│  ┌──────────────┐         ┌──────────────┐          │
│  │ OpenLayers   │ ◄─────► │  WebSocket   │          │
│  │  地图可视化   │         │   客户端      │          │
│  └──────────────┘         └──────────────┘          │
└─────────────────────────────────────────────────────┘
                             ▲
                             │ WebSocket
                             ▼
┌─────────────────────────────────────────────────────┐
│              后端 (Python + FastAPI)                 │
│  ┌──────────────┐         ┌──────────────┐          │
│  │   FastAPI    │ ◄─────► │  WebSocket   │          │
│  │  HTTP Server │         │    服务器     │          │
│  └──────────────┘         └──────────────┘          │
│                               │                      │
│                               ▼                      │
│                    ┌──────────────────┐              │
│                    │   SimPy Engine   │              │
│                    │   仿真引擎        │              │
│                    └──────────────────┘              │
└─────────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 前置要求

- Python 3.8+
- 现代浏览器（Chrome, Firefox, Edge）

### 安装依赖

```bash
# 安装 Python 依赖
pip install -r requirements.txt
```

### 运行系统

```bash
# 启动后端服务器
cd backend
python server.py
```

服务器启动后，访问：**http://localhost:8000**

### 使用说明

1. **设置仿真时长** - 在控制面板输入仿真时长（秒）
2. **开始仿真** - 点击"开始仿真"按钮
3. **观察过程** - 在地图上观察物料流转和设备状态变化
4. **查看统计** - 右侧面板实时显示生产统计数据
5. **停止仿真** - 随时可点击"停止"按钮终止仿真

## 📁 项目结构

```
Simpy-OpenLayers-test/
├── backend/
│   ├── simulation.py      # SimPy 仿真模型
│   └── server.py          # FastAPI 服务器 + WebSocket
├── frontend/
│   ├── index.html         # 前端主页面
│   └── app.js             # OpenLayers 可视化逻辑
├── requirements.txt       # Python 依赖
└── README.md              # 项目文档
```

## 🔧 技术栈

### 后端
- **SimPy 4.1.1** - 离散事件仿真框架
- **FastAPI 0.109.0** - 现代化 Web 框架
- **Uvicorn** - ASGI 服务器
- **WebSockets** - 实时双向通信

### 前端
- **OpenLayers 8.2.0** - 开源地图库
- **HTML5/CSS3/JavaScript** - 标准 Web 技术
- **WebSocket API** - 浏览器原生 WebSocket

## 📊 仿真模型说明

### 生产线配置

- **工位数量**: 3个串行工位
  - 工位1: 粗加工
  - 工位2: 精加工
  - 工位3: 质检

- **缓冲区**: 工位之间各有一个缓冲区，容量5件

- **加工时间**: 符合正态分布 N(5, 1) 秒

- **到达间隔**: 符合指数分布，平均4秒

### 车间布局（平面坐标）

```
原料区 → 工位1 → 缓冲区1 → 工位2 → 缓冲区2 → 工位3 → 成品区
(0,20)   (10,20)  (20,20)   (30,20)  (40,20)   (50,20)  (60,20)
```

## 📈 统计指标

系统实时计算并显示以下KPI：

- **已生产数量** - 完成的产品总数
- **在制品(WIP)** - 系统中正在加工的产品数
- **产能** - 单位时间产量（件/秒）
- **周期时间** - 产品从进入到完成的平均时间
- **工位利用率** - 各工位的设备利用率（%）
- **排队时间** - 产品在各工位的平均等待时间

## 🎨 可视化元素

| 元素 | 颜色/形状 | 说明 |
|------|----------|------|
| 物料 | 蓝色圆点 | 移动的产品 |
| 工位（运行） | 绿色圆圈 | 正在加工 |
| 工位（空闲） | 灰色圆圈 | 等待物料 |
| 缓冲区 | 黄色方块 | 显示库存数量 |
| 原料区 | 蓝色虚线框 | 物料起点 |
| 成品区 | 绿色虚线框 | 物料终点 |

## 🔮 扩展方向

本项目可作为基础框架，扩展为更复杂的系统：

1. **复杂产线拓扑**
   - 并行生产线
   - 装配线
   - 柔性制造系统

2. **高级调度算法**
   - AGV路径规划
   - 动态调度优化
   - 瓶颈分析

3. **数字孪生**
   - 实时数据对接
   - 预测性维护
   - What-if 场景分析

4. **3D可视化**
   - Three.js 集成
   - BIM 模型加载
   - 虚拟现实(VR)

## 📚 参考资源

- [SimPy 官方文档](https://simpy.readthedocs.io/)
- [OpenLayers 官方文档](https://openlayers.org/)
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 开源协议

MIT License

## 👨‍💻 作者

基于 OpenLayers 车间生产数据地图技术方案开发

---

**🌟 如果这个项目对您有帮助，请给一个 Star！**
